#!/usr/bin/env node

const XLSX = require('xlsx');

/**
 * åˆ›å»ºä¸€ä¸ªç®€å•çš„é‡‘èå»ºæ¨¡æ¼”ç¤º Excel æ–‡ä»¶
 */

console.log('ğŸ“Š åˆ›å»ºæ¼”ç¤ºé‡‘èå»ºæ¨¡ Excel æ–‡ä»¶...\n');

// åˆ›å»ºå·¥ä½œç°¿
const wb = XLSX.utils.book_new();

// ============================================
// å·¥ä½œè¡¨ 1: æ”¶å…¥é¢„æµ‹
// ============================================
const revenueData = [
  ['æ”¶å…¥é¢„æµ‹è¡¨', '', '', '', '', ''],
  ['', '', '', '', '', ''],
  ['é¡¹ç›®', '2023', '2024', '2025', '2026', 'å¢é•¿ç‡'],
  ['äº§å“Aé”€å”®é¢', 1000000, 1200000, 1440000, 1728000, '20%'],
  ['äº§å“Bé”€å”®é¢', 800000, 920000, 1058000, 1216700, '15%'],
  ['æœåŠ¡æ”¶å…¥', 500000, 625000, 781250, 976563, '25%'],
  ['', '', '', '', '', ''],
  ['æ€»æ”¶å…¥', 2300000, 2745000, 3279250, 3921263, ''],
];

const revenueSheet = XLSX.utils.aoa_to_sheet(revenueData);

// æ·»åŠ å…¬å¼
revenueSheet['B8'] = { t: 'n', f: 'SUM(B4:B6)', v: 2300000 };
revenueSheet['C8'] = { t: 'n', f: 'SUM(C4:C6)', v: 2745000 };
revenueSheet['D8'] = { t: 'n', f: 'SUM(D4:D6)', v: 3279250 };
revenueSheet['E8'] = { t: 'n', f: 'SUM(E4:E6)', v: 3921263 };

// è®¾ç½®åˆ—å®½
revenueSheet['!cols'] = [
  { wch: 20 }, { wch: 12 }, { wch: 12 }, { wch: 12 }, { wch: 12 }, { wch: 10 }
];

XLSX.utils.book_append_sheet(wb, revenueSheet, 'æ”¶å…¥é¢„æµ‹');

// ============================================
// å·¥ä½œè¡¨ 2: æˆæœ¬åˆ†æ
// ============================================
const costData = [
  ['æˆæœ¬åˆ†æè¡¨', '', '', '', ''],
  ['', '', '', '', ''],
  ['é¡¹ç›®', '2023', '2024', '2025', '2026'],
  ['åŸææ–™æˆæœ¬', 600000, 720000, 864000, 1036800],
  ['äººå·¥æˆæœ¬', 800000, 880000, 968000, 1064800],
  ['è¿è¥æˆæœ¬', 400000, 440000, 484000, 532400],
  ['è¥é”€è´¹ç”¨', 300000, 360000, 432000, 518400],
  ['', '', '', '', ''],
  ['æ€»æˆæœ¬', 2100000, 2400000, 2748000, 3152400],
  ['', '', '', '', ''],
  ['æ¯›åˆ©æ¶¦', 200000, 345000, 531250, 768863],
  ['æ¯›åˆ©ç‡', '8.7%', '12.6%', '16.2%', '19.6%'],
];

const costSheet = XLSX.utils.aoa_to_sheet(costData);

// æ·»åŠ å…¬å¼
costSheet['B9'] = { t: 'n', f: 'SUM(B4:B7)', v: 2100000 };
costSheet['C9'] = { t: 'n', f: 'SUM(C4:C7)', v: 2400000 };
costSheet['D9'] = { t: 'n', f: 'SUM(D4:D7)', v: 2748000 };
costSheet['E9'] = { t: 'n', f: 'SUM(E4:E7)', v: 3152400 };

// æ¯›åˆ©æ¶¦ = æ”¶å…¥ - æˆæœ¬ï¼ˆå¼•ç”¨å¦ä¸€ä¸ªå·¥ä½œè¡¨ï¼‰
costSheet['B11'] = { t: 'n', f: 'æ”¶å…¥é¢„æµ‹!B8-B9', v: 200000 };
costSheet['C11'] = { t: 'n', f: 'æ”¶å…¥é¢„æµ‹!C8-C9', v: 345000 };
costSheet['D11'] = { t: 'n', f: 'æ”¶å…¥é¢„æµ‹!D8-D9', v: 531250 };
costSheet['E11'] = { t: 'n', f: 'æ”¶å…¥é¢„æµ‹!E8-E9', v: 768863 };

// æ¯›åˆ©ç‡ = æ¯›åˆ©æ¶¦ / æ”¶å…¥
costSheet['B12'] = { t: 'n', f: 'B11/æ”¶å…¥é¢„æµ‹!B8', v: 0.087, z: '0.0%' };
costSheet['C12'] = { t: 'n', f: 'C11/æ”¶å…¥é¢„æµ‹!C8', v: 0.126, z: '0.0%' };
costSheet['D12'] = { t: 'n', f: 'D11/æ”¶å…¥é¢„æµ‹!D8', v: 0.162, z: '0.0%' };
costSheet['E12'] = { t: 'n', f: 'E11/æ”¶å…¥é¢„æµ‹!E8', v: 0.196, z: '0.0%' };

costSheet['!cols'] = [
  { wch: 20 }, { wch: 12 }, { wch: 12 }, { wch: 12 }, { wch: 12 }
];

XLSX.utils.book_append_sheet(wb, costSheet, 'æˆæœ¬åˆ†æ');

// ============================================
// å·¥ä½œè¡¨ 3: ç°é‡‘æµé¢„æµ‹
// ============================================
const cashFlowData = [
  ['ç°é‡‘æµé¢„æµ‹è¡¨', '', '', '', ''],
  ['', '', '', '', ''],
  ['é¡¹ç›®', '2023', '2024', '2025', '2026'],
  ['æœŸåˆç°é‡‘', 500000, 600000, 945000, 1476250],
  ['ç»è¥ç°é‡‘æµå…¥', 2300000, 2745000, 3279250, 3921263],
  ['ç»è¥ç°é‡‘æµå‡º', -2100000, -2400000, -2748000, -3152400],
  ['æŠ•èµ„æ”¯å‡º', -200000, -150000, -180000, -216000],
  ['èèµ„æ´»åŠ¨', 100000, 150000, 180000, 0],
  ['', '', '', '', ''],
  ['æœŸæœ«ç°é‡‘', 600000, 945000, 1476250, 2029113],
  ['ç°é‡‘å‡€å˜åŒ–', 100000, 345000, 531250, 552863],
];

const cashFlowSheet = XLSX.utils.aoa_to_sheet(cashFlowData);

// æ·»åŠ å…¬å¼
cashFlowSheet['B10'] = { t: 'n', f: 'SUM(B4:B8)', v: 600000 };
cashFlowSheet['C10'] = { t: 'n', f: 'SUM(C4:C8)', v: 945000 };
cashFlowSheet['D10'] = { t: 'n', f: 'SUM(D4:D8)', v: 1476250 };
cashFlowSheet['E10'] = { t: 'n', f: 'SUM(E4:E8)', v: 2029113 };

cashFlowSheet['B11'] = { t: 'n', f: 'B10-B4', v: 100000 };
cashFlowSheet['C11'] = { t: 'n', f: 'C10-C4', v: 345000 };
cashFlowSheet['D11'] = { t: 'n', f: 'D10-D4', v: 531250 };
cashFlowSheet['E11'] = { t: 'n', f: 'E10-E4', v: 552863 };

cashFlowSheet['!cols'] = [
  { wch: 20 }, { wch: 12 }, { wch: 12 }, { wch: 12 }, { wch: 12 }
];

XLSX.utils.book_append_sheet(wb, cashFlowSheet, 'ç°é‡‘æµé¢„æµ‹');

// ä¿å­˜æ–‡ä»¶
const fileName = 'financial-model-demo.xlsx';
XLSX.writeFile(wb, fileName);

console.log(`âœ… æ¼”ç¤ºæ–‡ä»¶åˆ›å»ºæˆåŠŸ: ${fileName}`);
console.log('\nåŒ…å«ä»¥ä¸‹å·¥ä½œè¡¨:');
console.log('  1. æ”¶å…¥é¢„æµ‹ - å¤šå¹´æ”¶å…¥é¢„æµ‹æ•°æ®');
console.log('  2. æˆæœ¬åˆ†æ - æˆæœ¬ç»“æ„å’Œæ¯›åˆ©ç‡è®¡ç®—');
console.log('  3. ç°é‡‘æµé¢„æµ‹ - ç°é‡‘æµé‡è¡¨\n');
console.log('ç°åœ¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ†æ:\n');
console.log(`  node analyze-excel.js ${fileName}`);
console.log(`  node analyze-excel.js ${fileName} --all`);
console.log(`  node analyze-excel.js ${fileName} --sheet "æˆæœ¬åˆ†æ" --formulas\n`);
